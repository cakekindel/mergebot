name: 'deploy'

on:
  push:
    branches: [ 'main' ]

jobs:
  deploy:
    runs-on: 'ubuntu-latest'
    steps:
    - uses: 'actions/checkout@v2'

    - uses: 'digitalocean/action-doctl@v2'
      with:
        token: ${{ secrets.DO_TOKEN }}

    - uses: actions/cache@v2
      with:
        path: |
          ~/.rustup
          ~/.cargo
          target
        key: ${{ runner.os }}-cargo

    - uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        script: systemctl restart mergebot
